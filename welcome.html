
<html>
<head>
    <title> Bob's Auto Parts: Order result</title>
</head>
<body>
    <?php

    $servername = "au-cdbr-azure-east-a.cloudapp.net";
    $user="b1b3a3d7f0a6e5";
    $password="dce1b964";
    $dbname="deployment_database";

    // Create connection
    $conn = new mysqli($servername,$user, $password,$dbname);
    $stmt = $conn->prepare("INSERT INTO Orders (firstname, lastname, noOftyres, Amount)
    VALUES (?, ?, ?,?)");

    // "s" means the database expects a string "i" means integer
    $stmt->bind_param("ssii", $unsafe_firstname,$unsafe_lasstname,$unsafe_nooftyres,$unsafe_amount);

    $unsafe_firstname = $_POST['firstname'];
    $unsafe_lasstname = $_POST['lastname'];
    $unsafe_nooftyres = $_POST['tyres'];
    $unsafe_amount = ($_POST["tyres"]* 110);
    
    $stmt->execute();

    echo $_POST["firstname"]." ".$_POST["lastname"].'<br/>';
    echo "total amount due is: ".($_POST["tyres"]* 110).'<br/>';

    echo "<br/>";
    echo "<table>";
        $sql = "SELECT * from orders";
        $result = $conn->query($sql);
        if ($result->num_rows > 0) {
        echo "<tr><td>Firstname</td><td>Lastname</td><td># Tyres</td><td>Amount</td></tr>";
        // output data of each row
        while($row = $result->fetch_assoc()) {
        echo "<tr><td>". $row["firstname"]. "</td><td>". $row["lastname"]. "</td><td>" . $row["noOftyres"] . "</td><td>".$row["Amount"]."</td></tr>";
    }
    
} else {
echo "0 results";
}
echo "</table>";

$stmt->close();

$mysqli->close();

$conn->close();
?>
</body>
</html>